<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>clustur • clustur</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="clustur">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clustur</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/clustur.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SchlossLab/clustur/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>clustur</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SchlossLab/clustur/blob/master/vignettes/clustur.Rmd" class="external-link"><code>vignettes/clustur.Rmd</code></a></small>
      <div class="d-none name"><code>clustur.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>clustur was developed to be similar to <a href="https://mothur.org/wiki/cluster/" class="external-link">mothur’s cluster function</a>
that was written in C++. In order to cluster your data, users need to
provide their own sparse or phylip-formatted distance matrix. They also
need to provide a count table that either comes from mothur or that they
create in R. Once these objects are built users can call the
<code><a href="../reference/cluster.html">cluster()</a></code> function. We currently support 5 methods:
opticlust (default) and furthest, nearest, weighted, and average
neighbor. The opticlust method is <code><a href="../reference/cluster.html">cluster()</a></code> and mothur’s
default. The speed of the methods implemented in {clustur} and mothur
are comparable; {clustur} may even be faster! Below we will show you how
to create your sparse matrix and count table. If you do not have a count
table, clustur can produce one from you, but it will assume the
abundance of each sequence is one and it will only cluster the sequences
in the distance matrix. The output of running <code><a href="../reference/clustur-package.html">clustur()</a></code>
includes what is typically provided in a mothur-formatted shared
file.</p>
</div>
<div class="section level2">
<h2 id="starting-up">Starting Up<a class="anchor" aria-label="anchor" href="#starting-up"></a>
</h2>
<p>For the official release from CRAN you can use the standard
<code><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages()</a></code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install via cran</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"clustur"</span><span class="op">)</span></span></code></pre></div>
<p>For the developmental version, you can use the
<code>install_github()</code> function from the {devtools} package</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install via github</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"SchlossLab/clustur"</span><span class="op">)</span></span></code></pre></div>
<p>Because {clustur}’s functions make use of a random number generator,
users are strongly encouraged to set the seed.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.schlosslab.org/clustur/">clustur</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">19760620</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-count-files">Read count files<a class="anchor" aria-label="anchor" href="#read-count-files"></a>
</h2>
<p>clustur will produce the same output using either a sparse (default)
or full <a href="https://mothur.org/wiki/count_file/" class="external-link">count
table</a></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_count_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_count.html">read_count</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon.full.count_table"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sparse_count_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_count.html">read_count</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon.sparse.count_table"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-distance-matrix-file">Read distance matrix file<a class="anchor" aria-label="anchor" href="#read-distance-matrix-file"></a>
</h2>
<p>clustur will read both mothur’s <a href="https://mothur.org/wiki/column-formatted_distance_matrix/" class="external-link">column/sparse
distance matrix</a> and <a href="https://mothur.org/wiki/phylip-formatted_distance_matrix/" class="external-link">Phylip-formatted
distance</a> matrix formats.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">column_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_dist.html">read_dist</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon_column.dist"</span><span class="op">)</span>, <span class="va">full_count_table</span>, cutoff <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phylip_distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_dist.html">read_dist</a></span><span class="op">(</span><span class="fu"><a href="../reference/example_path.html">example_path</a></span><span class="op">(</span><span class="st">"amazon_phylip.dist"</span><span class="op">)</span>, <span class="va">full_count_table</span>, cutoff <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span></code></pre></div>
<p>The return value of <code>distance_data</code> will be a memory
address. If you want a data frame version of the distances, you can use
<code>get_distance_df(distance_data)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_distance_df.html">get_distance_df</a></span><span class="op">(</span><span class="va">column_distance</span><span class="op">)</span></span>
<span><span class="co">#&gt;    FirstName SecondName Distance</span></span>
<span><span class="co">#&gt; 1     U68638     U68618 0.020396</span></span>
<span><span class="co">#&gt; 2     U68638     U68620 0.020396</span></span>
<span><span class="co">#&gt; 3     U68638     U68658 0.027067</span></span>
<span><span class="co">#&gt; 4     U68618     U68620 0.000000</span></span>
<span><span class="co">#&gt; 5     U68618     U68658 0.022512</span></span>
<span><span class="co">#&gt; 6     U68620     U68658 0.022512</span></span>
<span><span class="co">#&gt; 7     U68641     U68667 0.000000</span></span>
<span><span class="co">#&gt; 8     U68641     U68673 0.018238</span></span>
<span><span class="co">#&gt; 9     U68667     U68673 0.018238</span></span>
<span><span class="co">#&gt; 10    U68636     U68631 0.006024</span></span>
<span><span class="co">#&gt; 11    U68680     U68615 0.003141</span></span>
<span><span class="co">#&gt; 12    U68679     U68663 0.020354</span></span>
<span><span class="co">#&gt; 13    U68679     U68665 0.017144</span></span>
<span><span class="co">#&gt; 14    U68679     U68688 0.009987</span></span>
<span><span class="co">#&gt; 15    U68665     U68663 0.012295</span></span>
<span><span class="co">#&gt; 16    U68665     U68688 0.008059</span></span>
<span><span class="co">#&gt; 17    U68663     U68688 0.020272</span></span>
<span><span class="fu"><a href="../reference/get_distance_df.html">get_distance_df</a></span><span class="op">(</span><span class="va">phylip_distance</span><span class="op">)</span></span>
<span><span class="co">#&gt;    FirstName SecondName Distance</span></span>
<span><span class="co">#&gt; 1     U68615     U68680 0.003141</span></span>
<span><span class="co">#&gt; 2     U68618     U68620 0.000000</span></span>
<span><span class="co">#&gt; 3     U68618     U68638 0.020396</span></span>
<span><span class="co">#&gt; 4     U68618     U68658 0.022512</span></span>
<span><span class="co">#&gt; 5     U68620     U68638 0.020396</span></span>
<span><span class="co">#&gt; 6     U68620     U68658 0.022512</span></span>
<span><span class="co">#&gt; 7     U68631     U68636 0.006024</span></span>
<span><span class="co">#&gt; 8     U68638     U68658 0.027067</span></span>
<span><span class="co">#&gt; 9     U68641     U68667 0.000000</span></span>
<span><span class="co">#&gt; 10    U68641     U68673 0.018238</span></span>
<span><span class="co">#&gt; 11    U68663     U68665 0.012295</span></span>
<span><span class="co">#&gt; 12    U68663     U68679 0.020354</span></span>
<span><span class="co">#&gt; 13    U68663     U68688 0.020272</span></span>
<span><span class="co">#&gt; 14    U68665     U68679 0.017144</span></span>
<span><span class="co">#&gt; 15    U68665     U68688 0.008059</span></span>
<span><span class="co">#&gt; 16    U68667     U68673 0.018238</span></span>
<span><span class="co">#&gt; 17    U68679     U68688 0.009987</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="clustering-the-data">Clustering the data<a class="anchor" aria-label="anchor" href="#clustering-the-data"></a>
</h2>
<p>The default method for clustering in <code>cluster</code> is
“opticlust”</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cutoff</span> <span class="op">&lt;-</span> <span class="fl">0.03</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">column_distance</span>, <span class="va">cutoff</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="selecting-different-clustering-methods">Selecting different clustering methods<a class="anchor" aria-label="anchor" href="#selecting-different-clustering-methods"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">column_distance</span>, <span class="va">cutoff</span>, method <span class="op">=</span> <span class="st">"furthest"</span><span class="op">)</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">column_distance</span>, <span class="va">cutoff</span>, method <span class="op">=</span> <span class="st">"nearest"</span><span class="op">)</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">column_distance</span>, <span class="va">cutoff</span>, method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">column_distance</span>, <span class="va">cutoff</span>, method <span class="op">=</span> <span class="st">"weighted"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="output-data-from-clustering">Output data from clustering<a class="anchor" aria-label="anchor" href="#output-data-from-clustering"></a>
</h2>
<div class="section level4">
<h4 id="edit-this-paragraph-further">edit this paragraph further…<a class="anchor" aria-label="anchor" href="#edit-this-paragraph-further"></a>
</h4>
<p>All methods produce a list object with an indicator of the cutoff
that was used (<code>label</code>), as well as cluster composition
(<code>cluster</code>) and shared (<code>abundance</code>) data frames.
The <code>clusters</code> data frame shows which OTU (Operation
Taxonomic Unit) each sequence was assigned to. The
<code>abundance</code> data frame contains columns indicating the
<code>OTU</code> and <code>sample</code> identifiers and the abundance
of each OTU in each sample. The OptiClust method also includes the
<code>metrics</code> data frame, which describe the optimization value
for each iteration in the fitting process; the data in
<code>clusters</code> and <code>shared</code> are taken from the last
iteration. clustur provides getter functions, <code>get_label()</code>,
<code>get_clusters()</code>, <code>get_shared()</code>, and
<code><a href="../reference/get_metrics.html">get_metrics()</a></code>, which will be demonstrated below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster.html">cluster</a></span><span class="op">(</span><span class="va">column_distance</span>, <span class="va">cutoff</span>, method <span class="op">=</span> <span class="st">"opticlust"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_cutoff.html">get_cutoff</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.03</span></span>
<span><span class="fu"><a href="../reference/get_bins.html">get_bins</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt;   feature  bin</span></span>
<span><span class="co">#&gt; 1  U68630 bin1</span></span>
<span><span class="co">#&gt; 2  U68595 bin2</span></span>
<span><span class="co">#&gt; 3  U68600 bin3</span></span>
<span><span class="co">#&gt; 4  U68591 bin4</span></span>
<span><span class="co">#&gt; 5  U68647 bin5</span></span>
<span><span class="co">#&gt; 6  U68661 bin6</span></span>
<span><span class="co">#&gt; 7  U68605 bin7</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 81 rows ]</span></span>
<span><span class="fu"><a href="../reference/get_abundance.html">get_abundance</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt;   samples  otu abundance</span></span>
<span><span class="co">#&gt; 1 pasture otu1         0</span></span>
<span><span class="co">#&gt; 2  forest otu1         1</span></span>
<span><span class="co">#&gt; 3 pasture otu2         0</span></span>
<span><span class="co">#&gt; 4  forest otu2         1</span></span>
<span><span class="co">#&gt; 5 pasture otu3         0</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 171 rows ]</span></span>
<span><span class="fu"><a href="../reference/get_metrics.html">get_metrics</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></span>
<span><span class="co">#&gt; $metrics</span></span>
<span><span class="co">#&gt;      label   cutoff specificity      ppv       ttp  f1score          tn</span></span>
<span><span class="co">#&gt; 1 0.030000 0.030000    1.000000 1.000000 17.000000 1.000000 4736.000000</span></span>
<span><span class="co">#&gt;        mcc       fn       fp sensitivity      npv      fdr accuracy</span></span>
<span><span class="co">#&gt; 1 1.000000 0.000000 0.000000    1.000000 1.000000 1.000000 1.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $iteration_metrics</span></span>
<span><span class="co">#&gt;      iter time label num_otus cutoff tp tn fp fn sensitivity specificity ppv</span></span>
<span><span class="co">#&gt;      npv fdr accuracy mcc f1score</span></span>
<span><span class="co">#&gt;  [ reached 'max' / getOption("max.print") -- omitted 3 rows ]</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gregory Johnson, Sarah Westcott, Patrick Schloss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
